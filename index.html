<html><head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
  
    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link href="https://pingendo.github.io/pingendo-bootstrap/themes/default/bootstrap.css" rel="stylesheet" type="text/css">
    
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.4.8/angular.min.js"></script>
	<script src="js/util.js"></script>
	
	 <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/prism/0.0.1/prism.min.js"></script>
     <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.16/d3.min.js"></script>
     <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/d3-tip/0.6.7/d3-tip.min.js"></script>
     
	 <link href="css/wooda.css" rel="stylesheet" type="text/css">
	<link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.6.4/css/bootstrap-datepicker.min.css" rel="stylesheet" type="text/css"></link>
	
	
  <!-- 
 	<link rel="stylesheet" href="https://openlayers.org/en/v3.18.2/css/ol.css" type="text/css">
    <script src="https://openlayers.org/en/v3.18.2/build/ol.js" type="text/javascript"></script>
    -->	
    
    <script src="https://maps.google.com/maps/api/js?key=AIzaSyDvC3Vt_2EsPjHF89hsS0rm1wVvM5qK-Rg&sensor=false" type="text/javascript"></script> 
    	
    	
	<meta name="viewport" content="width=device-width,user-scalable=no">
 
    <script type="text/javascript" src="https://spotfire.cloud.tibco.com/spotfire/wp/GetJavaScriptApi.ashx?Version=7.5"></script>
   <!-- 
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootbox.js/4.4.0/bootbox.min.js"></script>
     -->
 
  </head><body >
  <div data-ng-app="myApp">
    <div class="navbar navbar-default navbar-static-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar-ex-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" id='wooda_icon' href="#"><img src='img/logo_wooda_w.png' style='height:50px;margin-top:-15px;margin-right:-3px;float:left'></img><span style='float:left'>ooda</span></a>
          <img style='float:left;height:32px;background-color:white;margin-top:10px;' src='img/bankinter.png'/>
          
        </div>
        <div class="collapse navbar-collapse" id="navbar-ex-collapse">
          <a href="#" class="navbar-right"><i data-toggle="tooltip" title="Salir"  data-placement="bottom" onclick="showLogout();" class="fa fa-2x fa-fw fa-user text-muted button_header_items logged_in"></i></a>
          <!-- 
          <a href="#" class="navbar-right"><i class="fa fa-2x fa-bell fa-fw text-muted button_header_items logged_in"></i></a>
           -->
          <a href="#" class="navbar-right"><i id='help_icon' data-toggle="tooltip" title="Ayuda"  data-placement="bottom" class="fa fa-2x fa-fw fa-question text-muted button_header_items logged_in"></i></a>
          <ul class="nav navbar-nav navbar-right">
            <li>
              <a style='display:none' href="#" id='calendar_top_button' class='top_buttons -disabled-logged_in' >Calendario</a>
            </li>
            <li>
              <a style='display:none' href="#" id='pipeline_top_button' class='top_buttons logged_in'>Oportunidades Activas</a>
            </li>
            <li>
              <a style='display:none' href="#" id='suggested_top_button' class='top_buttons logged_in'>Sugerencias <span class="badge badge_top" id='suggested_top_badge'>+100</span></a>
            </li>
            <li>
              <a style='display:none' href="#" id='company_top_button' class='top_buttons -disabled-logged_in'>Empresa</a>
            </li>
            <li>
              <a style='display:none' href="#" id='dashboard_top_button' class='top_buttons -disabled-logged_in'>B&uacute;squeda</a>
            </li>
          </ul>
          <span class='navbar-left logged_in' id='user_name'></span>
          <!-- 
          <form style='display:none' class="navbar-form navbar-left logged_in" role="search">
            <div class="form-group">
              <input type="text" class="form-control" placeholder="Search">
            </div>
            <button  type="button" class="btn btn-default" id='search_box' data-toggle="tooltip" title="Search company"  data-placement="bottom">Go!</button>
          </form>
           -->
        </div>
      </div>
    </div>
      <!-- -------------------- -->
  <!-- Modal -->
  <div class="modal fade" id="myModal" role="dialog">
    <div class="modal-dialog">
    
      <!-- Modal content-->
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal">&times;</button>
          <h4 class="modal-title">Modal Header</h4>
        </div>
        <div class="modal-body">
          <p>Some text in the modal.</p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default modal-button" id='button_yes' data-dismiss="modal">Yes</button>
          <button type="button" class="btn btn-default modal-button" id='button_no' data-dismiss="modal">No</button>
        </div>
      </div>
      
    </div>
  </div>
    <!-- Modal -->
    <div class="modal fade" id="modalAddSuggestion" role="dialog">
    <div class="modal-dialog">
    
      <!-- Modal content-->
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal">&times;</button>
          <h4 class="modal-title">Ordenar/Filtrar</h4>
        </div>
        <div class="modal-body">
        <p>Ordenar por</p>
        
        <p><strong>Campo: </strong>
        <select id='select_order_field'>
          		<option value="N">Sin orden</option>
                <option value="P" selected='true'>Propension</option>
                <option value="R">Riesgo</option>
                <option value="M">Municipio</option>
                <option value="V">Volumen de negocio</option>
          </select>
          </p>	
          <p><strong>Orden: </strong>
          <select id='select_order_criteria'>
          	<option value="A" selected='true'>Ascendente</option>
  			<option value="D">Descendente</option>
          </select></p>	
		<hr/>

       <p>Filtrar por</p>
        
        <p><strong>Riesgo: </strong>
        <span style='padding-left:20px;'>
        <input type="checkbox" name="ipe" id='ipe_1' value="1" checked> 1 - Bajo </input> 
  		<input type="checkbox" name="ipe" id='ipe_2' value="2" checked> 2 - Medio </input>  
		<input type="checkbox" name="ipe" id='ipe_3' value="3" checked> 3 - Alto </input>
		</span>
		</p>

        <p><strong>Import/Export: </strong>
        <span style='padding-left:20px;'>
        <input type="checkbox" name="export" id='export_0' value="0" checked> 0 - No exporta </input> 
        <input type="checkbox" name="export" id='export_1' value="1" checked> 1 - Bajo </input> 
  		<input type="checkbox" name="export" id='export_2' value="2" checked> 2 - Medio </input>  
		<input type="checkbox" name="export" id='export_3' value="3" checked> 3 - Alto </input>
		<input type="checkbox" name="export" id='export_4' value="4" checked> 4 - Muy Alto </input>
		</span>
		</p>
  
          <p><strong>Propension</strong>
        <span style='padding-left:20px;'>
        <input type="checkbox" name="propension" id='propension_1' value="1" checked> 1 - Muy Alta </input> 
  		<input type="checkbox" name="propension" id='propension_2' value="2" checked> 2 - Alta </input>   
		<input type="checkbox" name="propension" id='propension_3' value="3" checked> 3 - Baja </input>
    <input type="checkbox" name="propension" id='propension_4' value="4" checked> 4 - Muy baja </input>

		</span>
		</p>
  
    	<p><strong>Filtro por nombre (cif/razon social)</strong>
        <span style='padding-left:20px;'>
        	<input type="input" name="filtro_nombre" id='filtro_nombre' value=""></input>
		</span>
		</p>
          
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default modal-button" id='button_yes' data-dismiss="modal">Filtrar/Ordenar</button>
          <button type="button" class="btn btn-default modal-button" id='button_no' data-dismiss="modal">Cancelar</button>
        </div>
      </div>
      
    </div>
  </div>
    <!-- Modal -->
    
    <!-- Modal -->
    <div class="modal fade" id="modalPipeline" role="dialog">
    <div class="modal-dialog">
    
      <!-- Modal content-->
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal">&times;</button>
          <h4 class="modal-title">Ordenar/Filtrar</h4>
        </div>
        <div class="modal-body">
        <p>Ordenar por</p>
        
        <p><strong>Campo: </strong>
        <select id='select_order_field'>
          		<option value="N">Sin orden</option>
                <option value="P" selected='true'>Propension</option>
                <option value="R">Riesgo</option>
                <option value="M">Municipio</option>
                <option value="V">Volumen de negocio</option>
          </select>
          </p>	
          <p><strong>Orden: </strong>
          <select id='select_order_criteria'>
          	<option value="A" selected='true'>Ascendente</option>
  			<option value="D">Descendente</option>
          </select></p>	
		<hr/>

       <p>Filtrar por</p>
        
        <p><strong>Contactada: </strong>
        <span style='padding-left:20px;'>
        <input type="checkbox" name="ipe" id='visited_1' value="SI" checked> SI </input> 
  		<input type="checkbox" name="ipe" id='visited_2' value="NO" checked> NO </input>  
		</span>
		</p>
		<p><strong>Interes: </strong>
        <span style='padding-left:20px;'>
        <input type="checkbox" name="ipe" id='interes_1' value="SI" checked> SI </input> 
  		<input type="checkbox" name="ipe" id='interes_2' value="NO" checked> NO </input>  
  		<input type="checkbox" name="ipe" id='interes_3' value="VACIO" checked> VACIO </input>  
		</span>
		</p>  
        
        <p><strong>Filtro por nombre (cif/razon social)</strong>
        <span style='padding-left:20px;'>
        	<input type="input" name="filtro_nombre" id='filtro_nombre' value=""></input>
		</span>
		</p>
		
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default modal-button" id='button_yes' data-dismiss="modal">Filtrar/Ordenar</button>
          <button type="button" class="btn btn-default modal-button" id='button_no' data-dismiss="modal">Cancelar</button>
        </div>
      </div>
      
    </div>
  </div>
    <!-- Modal -->
  <div class="modal fade" id="newOpportunity" role="dialog">
    <div class="modal-dialog">
    
      <!-- Modal content-->
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal">&times;</button>
          <h4 class="modal-title">Add new Opportunity</h4>
        </div>
        <div class="modal-body">
	      <p>
	    	  <span style='float:left;margin-top:5px;' >CIF (VAT Number):</span>
		      <input type="text" class="form-control" style='width:120px;height:25px;left:120px;position:absolute;margin-left:15px;' id="usr">
		  </p>
		  <br/>
		  <p>
	    	  <span style='float:left;margin-top:5px;' >Company name:</span>
		      <input type="text" class="form-control" style='width:180px;height:25px;left:120px;position:absolute;margin-left:15px;' id="usr">
		  </p>
		  <br/>
	      <hr/>
	      <div>
	      <h5>Products</h5>	      
			<div class="checkbox"><label><input type="checkbox" value="1"> <span class='fa fa-2x fa-fw fa-shopping-basket text-danger product_list_icons'></span> PoS</label> <span class='add_opportunity_item'>Expected Value: <input type='text'/></span></div>
			<div class="checkbox"><label><input type="checkbox" value="2"><span class='fa fa-2x fa-fw fa-file-text text-danger product_list_icons'></span> Factoring</label> <span class='add_opportunity_item'>Expected Value: <input type='text'/></span></div>
			<div class="checkbox"><label><input type="checkbox" value="3"><span class='fa fa-2x fa-fw fa-bank text-danger product_list_icons'></span> Deposit</label> <span class='add_opportunity_item'>Expected Value: <input type='text'/></span></div>
			<div class="checkbox"><label><input type="checkbox" value="4"><span class='fa fa-2x fa-fw fa-credit-card text-danger product_list_icons'></span> Account/Credit Card</label> <span class='add_opportunity_item'>Expected Value: <input type='text'/></span></div>
			<div class="checkbox"><label><input type="checkbox" value="5"><span class='fa fa-2x fa-fw fa-rocket text-danger product_list_icons'></span> Startup Loan (ICO)</label> <span class='add_opportunity_item'>Expected Value: <input type='text'/></span></div>
			<div class="checkbox"><label><input type="checkbox" value="6"><span class='fa fa-2x fa-fw fa-server text-danger product_list_icons'></span> Leasing</label> <span class='add_opportunity_item'>Expected Value: <input type='text'/></span></div>
			<div class="checkbox"><label><input type="checkbox" value="7"><span class='fa fa-2x fa-fw fa-car text-danger product_list_icons'></span> Renting</label> <span class='add_opportunity_item'>Expected Value: <input type='text'/></span></div>
			<div class="checkbox"><label><input type="checkbox" value="8"><span class='fa fa-2x fa-fw fa-home text-danger product_list_icons'></span> Loan</label> <span class='add_opportunity_item'>Expected Value: <input type='text'/></span></div>
        </div>
         <hr/>
        	
        <div>
        <div style='margin-top:10px'>
			<p>Select preferred contact channel</p>
			<label class="radio-inline"><input type="radio" name="optradio" checked="checked">Phone</label>
			<label class="radio-inline"><input type="radio" name="optradio">SMS</label>
			<label class="radio-inline"><input type="radio" name="optradio">Email</label>
			<label class="radio-inline"><input type="radio" name="optradio">Sales force visit</label>
		</div>
        
        </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default modal-button" data-dismiss="modal">Save</button>
          <button type="button" class="btn btn-default modal-button" data-dismiss="modal">Dismiss</button>

        </div>
      </div>
      
    </div>
  </div>
  
<!--  About Wooda -->
  <div class="modal fade" id="modalWooda" role="dialog">
    <div class="modal-dialog">
    
      <!-- Modal content-->
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal">&times;</button>
          <h4 class="modal-title">About Wooda</h4>
        </div>
        <div class="modal-body">
          <h3 style='margin-top:-5px'>What's WOODA ?</h3>
          
         <h5>Window Of Opportunity + OODA</h5><br/>
          Wooda is a Next Activity Analytical Recommender system based on two concepts:<br/>
          <ul>
          <li>Identify a <b>Window Of Opportunity</b> for a sales action</li>
          <li>Steps in the loop: <b>Observe → Orient → Decide → Act</b>
          </li>
          </ul>
          <img style='width:320px;margin-left: 100px;margin-bottom:15px' src='img/wooda.png'/>
          <br/> 
          <span style='font-size:1.0em'>
          Developed by military strategist and USAF Colonel John Boyd. Boyd applied the concept to the combat operations process, often at the strategic level in military operations. It is now also often applied to understand commercial operations and learning processes. The approach favors agility over raw power in dealing with human opponents in any endeavor.
          </span>
          </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-default modal-button" data-dismiss="modal">Close</button>
        </div>
      </div>
      
    </div>
  </div>
  
  
<!-- -------------------- -->
<!--  HELP Wooda -->
  <div class="modal fade" id="modalHelp" role="dialog">
    <div class="modal-dialog">
    
      <!-- Modal content-->
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal">&times;</button>
          <h4 class="modal-title">Ayuda</h4>
        </div>
        <div class="modal-body">
          <h3>Wooda - Contenidos de la Ayuda</h3>
          <ul>
        <li>
        	No disponible por el momento <br/>Por favor contacte <a href='javascript:help_support()'> AQUI </a> con para resolver sus dudas
        </li>
<!-- 
        <li>
            <a href="#Lnk">New users tutorial</a>
        </li>
        <li>
            <a href="#Lnk">Adding an opportunity</a>
        </li>
        <ol>
            <li>
                <a href="#Lnk">How does suggestion engine work?</a>
            </li>
        </ol>
        <ol>
            <li>
                <a href="#Lnk">Managing pipeline</a>
            </li>
            <li>
                <a href="#Lnk">How to get the max out the reporting tool</a>
            </li>
            <li> Other features
	            <ol>
	            <li>
               	 <a href="#Lnk">Locating a company</a>
               	 </li>
               	 <li>
               	  <a href="#Lnk">Phone and Email details</a>
                
                </ol>
            </li>
        </ol>

            <li>
                <a href="#Lnk">About</a>
            </li>
             -->
</ul>
        </div>
        <!-- 
        <div class='ateam-image-container'>
        	<img src='img/ateam.jpg' class='ateam-image'>
        </div>
         -->
        <div class="modal-footer">
          <button type="button" class="btn btn-default modal-button" data-dismiss="modal">Cerrar</button>
        </div>
      </div>
      
    </div>
  </div>
  
  
<!-- -------------------- -->
    <div class="section" >

	<div class="container wooda_view"  data-ng-controller="loginController" id='login_view'>
      	   <div class="row">
        	<div class="col-md-offset-4 col-md-4">
            <div class="form-login">
            <h3 style='width:100%; text-align:center;'>Acceso de Usuarios</h3>
            <input type="text" id="userName" class="form-control input-sm chat-input" value='daniel.alcojorblanco@equifax.com' placeholder="username" />
            <br/>
            <input type="password" id="userPassword" class="form-control input-sm chat-input" value='abc' placeholder="password" />
            <br/>
            <div class="wrapper" style='margin-bottom: 15px;'>
            <span class="group-btn">     
                <a href="#" onclick="show_view('pipeline');" class="btn btn-primary btn-md login_button">Entrar <i class="fa fa-sign-in"></i></a>
            </span>
            </div>
			<span>
             <label style='margin-left:10px;margin-bottom:15px;margin-right:25px;'><!-- <input type="checkbox" value="">  Recordar credenciales</label> --> <a href='javascript:forgot_password()'> Has olvidado tu clave?</a>
			</span>
            </div>
        </div>
    	</div>
	</div>  
	<div style='display:none' class="container wooda_view"  data-ng-controller="suggestedController" id='suggested_view'>
    <!-- SUGGESTED VIEW -->
    
        <!-- Nuevo bloque -->
       <div class="panel panel-default panel-table">
              <div class="panel-heading suggestions_header_bar">
                <div class="row ">
                
                  <div class="col col-xs-6">
                   
                    <h3 class="panel-title ">Oportunidades Sugeridas <button type="button" id='filter_suggested' data-loading-text="<i class='fa fa-circle-o-notch fa-spin'></i> Cargando" style='float:right;' class="btn btn-default">Filtro/Orden</button></h3> 
                  </div>
                    
                </div>
              </div>
              <div class="panel-body">
                <table class="table_suggestions table table-striped table-bordered table-list">
                  <thead>
                    <tr class='suggestions_header_bar suggestions_header_subbar'>
                        <th class='suggestions_header_title'>Empresa<span class=""></span></th>
                        <th class='suggestions_header_title'>Riesgo<span class=""></span></th>
                        <th class='suggestions_header_title'>Direccion<span class=""></span></th>
                        <th class='suggestions_header_title'>Municipio<span class=""></span></th>
                        <th class='suggestions_header_title' style='width:70px;'>Volumen negocio<span class=""></span></th>
                        <th class='suggestions_header_title'>Import/Export<span class=""></span></th>
                        <th class='suggestions_header_title'>Propension<span class=""></span></th>
                        <th class='suggestions_header_title'  >Accion</th>

                    </tr> 
                  </thead>
                  <tbody>
                          <tr data-ng-repeat="x in suggestion_list" data-ng-click='show_company($event);' data-cif='{{x.CIF}}' class='suggestion_row' style='cursor:hand'>
                            <td>{{x.nombre_empresa}}</td>
                            <td class='suggestion_item'><span class='suggestion_item'>{{x.IPE}}</span></td>
                            <td class='suggestion_item'><span class='suggestion_item'>{{x.calle}} {{x.n_mero}} {{x.resto}}</span></td>
                            <td class='suggestion_item'><span class='suggestion_item'>{{x.municipio}}</span></td>
                            <td class='suggestion_item'><span class='suggestion_item'>{{x.volumen_negocio}}</span></td>
                            <td class='suggestion_item'><span class='suggestion_item'>{{x.ScoreExport}}</span></td>
                            <td class='suggestion_item'><span class='suggestion_item'>{{x.Propension}}</span></td>
                            <td align="center">
                              <!-- 
                              <a data-name='{{x.NAME}}' data-cif='{{x.CIF}}' data-value='{{x.EXPECTED_VALUE}}'  class="suggestion-item btn btn-default" xdata-ng-click='showAreYouSure("adding this item");'><em class="fa fa-check"></em></a>
                               -->
                               
                              <a class="suggestion-item-delete btn btn-danger"><em class="fa fa-check-square-o"></em></a>
                            </td>

                          </tr>
                        </tbody>
                </table>
            
              </div>
              <div class="panel-footer">
                <!--
                <div class="row">
                  <div class="col col-xs-4">Page 1 of 3
                  </div>
                  <div class="col col-xs-8">
                    <ul class="pagination hidden-xs pull-right">
                      <li><a href="#">1</a></li>
                      <li><a href="#">2</a></li>
                      <li><a href="#">3</a></li>
                    </ul>
                    <ul class="pagination visible-xs pull-right">
                        <li><a href="#">«</a></li>
                        <li><a href="#">»</a></li>
                    </ul>
                  </div>
                </div>
                -->
              </div>
            </div>
    <!-- EO Nuevo bloque -->
    
     
    </div>
    <!--  CALENDAR VIEW BEGIN -->
       
      <div style='display:none' class="container wooda_view"  data-ng-controller="calendarController" id='calendar_view'>
        
      </div>
    <!--  CALENDAR VIEW END -->
    <!--  COMPANY VIEW END -->
    <div id='company_spinner' style='display:none'>
     <!-- <h3> Cargando </h3><div id='company_spinner_component' class="loader"></div> -->
    </div>
    
      <div style='display:none' class="container wooda_view" data-ng-controller="companyController" id='company_view'>
        <div class="row">
          <div class="col-md-4">
            <div class="row">
              <div class="col-md-12">
                <div class="row">
                  <div class="col-md-12">
													<div class="panel panel-default">
				<div class="panel-heading">
		<address>
				 <strong>{{company.nombre_empresa}}</strong>
				 <a href="#"><i data-toggle="tooltip" title="Informacion de Contacto y Localizacion" data-placement="bottom" onclick="switch_company_view('company_maps_view')" class="fa fa-3x fa-fw pull-right fa-info-circle button_top_items"></i></a>
				 <br />CIF: {{company.CIF}}<br /> 
				 <a href="tel:{{company.tel_fono}}"><abbr title="Phone">Telefono: </abbr> {{company.tel_fono}}<br/></a>
				 <span style='margin-top:5px;'></span><br/>
				 <small><strong>CNAE:</strong> {{company.cnae09}} - {{company.cnae2009_4dig_codd}}</small><br /> 
				 <small ><abbr title="Phone">Empleados: </abbr> {{company.empleados}}</small><br/>
				 <small><abbr title="Phone">Ingresos: </abbr> {{company.VENTAS|number}} euros</small>
				 </address>
				
				</div>
				<div class="panel-body ajusta">				
					<table class="table ajusta centrado">
				<tbody>
					<tr>
					
						<td id='company_risk_box' class="ajusta">
							<div class='bg-text label_box_company' data-bg-text="Riesgo">{{company.risk_score}}</div>
						</td>
					 
						<td colspan='2' id='company_propension_box' class=" ajusta">
							<div class="bg-text label_box_company" data-bg-text="Propension">{{company.propensity_score}}</div>
						</td>
					</tr>
<!-- 
					<tr>

						<td id='company_contact_box' class=" ajusta">
							<div class="bg-text label_box_company" data-bg-text="Reachability">{{company.contact_score}}</div>
						</td>
						<td id='company_web_box' class=" ajusta">
							<div class="bg-text label_box_company" data-bg-text="Online">{{company.web_score}}</div>
						</td>
					</tr>
 -->
				</tbody>
			</table>
				</div>
				<div class="panel-footer">
				<div class="panel panel-default">
					<div class="panel-heading">
						Otras empresas cercanas
					</div>
     		
					<span data-ng-repeat="x in company.nearby">
						<div style='height:18px' class="panel-body"  data-ng-if="$index < 3">
							<span  data-ng-click='show_company($event);' class='nearby_item' data-cif='{{x.CIF}}' >
							{{x.nombre_empresa}}</span>
							
						</div>
					</span>
<!-- 
					<div class="panel-footer">
						+ More recommendations
					</div>
 -->
			</div>
				</div>
			</div>
                   
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="col-md-8">
          <div class='row'>
          	<div class="col-md-5 pull-right">
	         	<a style='display:none' href="#"><i data-toggle="tooltip" title="Download Company Data" data-placement="bottom" onclick='download_file("sample.xls")' class="fa fa-3x fa-fw pull-right fa-download button_top_items"></i></a>
	            <a style='display:none' href="#"><i data-toggle="tooltip" title="Online Social Media Details" data-placement="bottom" onclick='switch_company_view("company_online_view")' class="fa fa-3x fa-fw pull-right fa-share-alt button_top_items"></i></a>
	            <a href="#"><i data-toggle="tooltip" title="Historia de la empresa" data-placement="bottom" onclick='switch_company_view("company_timeline_view")' class="fa fa-3x fa-fw pull-right fa-calendar button_top_items"></i></a>
	            <a style='' href="#"><i data-toggle="tooltip" title="Charts" data-placement="bottom" onclick='switch_company_view("company_charts_view")' class="fa fa-3x fa-fw pull-right fa-area-chart button_top_items"></i></a>
	            <a href="#"><i data-toggle="tooltip" title="Mapa e Informacion de Contacto" data-placement="bottom" onclick='switch_company_view("company_maps_view")' class="fa fa-3x fa-fw pull-right fa-map-marker button_top_items"></i></a>
                <a href="#"><i data-toggle="tooltip" title="Registro de actividad comercial" data-placement="bottom" onclick='switch_company_view("company_tasks_view")' class="fa fa-3x fa-fw pull-right fa-tasks button_top_items"></i></a>
          	</div>
          </div>
          <div id='company_tasks_view' class='company_contents'>
            <ul class="nav nav-pills">
              <li class="active">
                <a id='company_current_opportunities' href="#">Acciones comerciales</a>
              </li>
              <li class="">
                <a id='company_closed_opportunities' href="#">Notas</a>
              </li>
            </ul>
            <table class="table">
              <thead>
                <tr>
                  <th></th>
                  <th></th>
                  <th></th>
                  <th></th>
                </tr>
              </thead>
              <tbody>
                <tr class='opportunity_open'>
                  <td>
                    <a href="#"><i class="fa fa-2x fa-fw fa-home text-danger product_list_icons"></i></a>
                  </td>
                  <td>Contactada</td>
                  <td>-</td>
                  <td>
                    <div class="btn-group">
				 
				<button id='company_visited_flag' style='' class="btn btn-default">
					{{company.visit}}
				</button> 
				<button data-toggle="dropdown" class="btn btn-default dropdown-toggle">
					<span class="caret"></span>
				</button>
				<ul class="dropdown-menu">
					<li class="enabled"><a href="javascript:change_company_visited('SI')" >SI</a></li>
					<li class="enabled"><a href="javascript:change_company_visited('NO')" >NO</a></li>
				</ul>
			</div> 
                  </td>
                </tr>
                <tr class='opportunity_open'>
                  <td >
                    <a href="#"><i class="fa fa-2x fa-fw text-danger fa-thermometer-half product_list_icons"></i></a>
                  </td>
                  <td>Interesada</td>
                  <td>-</td>
                  <td>
                    <div class="btn-group">
				 <div id="company_interest_box">
				<button  id='company_interest_flag' style=''  class="btn btn-default">
					{{company.interest}}
				</button> 
				 
				<button data-toggle="dropdown" class="btn btn-default dropdown-toggle">
					<span class="caret"></span>
				</button>
				<ul class="dropdown-menu">				
					<li class="enabled company_visited"><a href="javascript:change_company_interested('SI')" >SI</a></li>
					<li class="enabled company_visited"><a href="javascript:change_company_interested('NO')" >NO</a></li>
				</ul>
				</div>
			</div> 
                  </td>
                </tr>
                <tr class='opportunity_open'>
                  <td>
                    <a href="#"><i class="fa fa-2x fa-commenting fa-fw text-danger product_list_icons"></i></a>
                  </td>
                  <td>Justificacion del estado</td>
                  <td>-</td>
                  <td>
                    <div class="btn-group">
				 <div id="company_justification_box">
				<button id='company_justification_flag' style='' class="btn btn-default">
					{{company.status_motive}}
				</button> 
				<button data-toggle="dropdown" class="btn btn-default dropdown-toggle">
					<span class="caret"></span>
				</button>
				<ul class="dropdown-menu">
					<li class="company_interested enabled"><a href="javascript:change_company_justification('HIPOTECA')" >HIPOTECA</a></li>
					<li class="company_interested enabled"><a href="javascript:change_company_justification('PRESTAMO PERSONAL')" >PRESTAMO PERSONAL</a></li>
					<li class="company_interested enabled"><a href="javascript:change_company_justification('CREDITO')" >CREDITO</a></li>
					<li class="company_interested enabled"><a href="javascript:change_company_justification('CREDITO COMERCIAL')" >CREDITO COMERCIAL</a></li>
					<li class="company_interested enabled"><a href="javascript:change_company_justification('LEASING')" >LEASING</a></li>
					<li class="company_interested enabled"><a href="javascript:change_company_justification('OTROS')" >OTROS</a></li>					
					<li class="divider">
					<li class="company_not_interested enabled"><a href="javascript:change_company_justification('YA CLIENTE BANKINTER')" >YA CLIENTE BANKINTER</a></li>
					<li class="company_not_interested enabled"><a href="javascript:change_company_justification('TRABAJA CON OTRO BANCO')" >TRABAJA CON OTRO BANCO</a></li>
					<li class="company_not_interested enabled"><a href="javascript:change_company_justification('NECESIDAD')" >NECESIDAD</a></li>
					<li class="company_not_interested enabled"><a href="javascript:change_company_justification('NO LE INTERESA BANKINTER')" >NO LE INTERESA BANKINTER</a></li>
					<li class="company_not_interested enabled"><a href="#" >OTRO MOTIVO</a></li>
				</ul>
				</div>
			<br/>
			
			  	<button  id='company_add_pipe' class="btn btn-default" style='background-color:green; color:white'>Añadir a pipeline</button>	
			  	<button  id='company_remove_pipe' class="btn btn-default" style='background-color:red; color:white'>Eliminar de pipeline</button>	
			
			</div> 
			
                  </td>
                </tr>
                <tr class='opportunity_closed'>
                  <td colspan='4'>
                  <textarea id='company_notes' style='width:90%' rows="10" cols="20">{{company.notes}}</textarea>
               	  </td>	
               </tr>
                <tr class='opportunity_closed'>
                  <td>
	               <div style='padding-top:15px'>
	              	<button  data-cif='{{company.CIF}}' id='update_company_notes' class="btn btn-default" style='background-color:green; color:white'>Actualizar</button>	
					</div>
	    
               	  </td>	
               </tr>

                

              </tbody>
            </table>
          </div>          
          <div id='company_charts_view' class='company_contents'>
			<div class='row'>			
			<iframe id='target_charts_iframe' style='border:0px;height:100%;' class='col-sm-12' src='#' scrolling="no" onload='resizeIframe(this)'></iframe>
			</div>

          </div>

          <div id='company_maps_view' class='company_contents'>
          	<div id="wrapper">
							<div id="map"></div>
<!-- 							<div id="over_map"></div>  -->
			</div>
		  <div id='company_address_container' class='row'>
		  <address class='col-md-8'>
		  <span class='contact_data_header'>{{company.nombre_empresa}} {{company.nombre_comercial}}</span><br>
		  <span class='contact_data_item'>CALLE {{company.calle}} {{company.n_mero}} {{company.resto}}</span><br>
		  <span class='contact_data_item'>{{company.municipio}} ({{company.provincia}}) - Codigo Postal: {{company.codigo_postal}}</span><br>
		   <span class='contact_data_item'><strong>Persona de contacto: </strong>{{company.nmb_conse_direc}} <strong> Cargo:</strong>{{company.cod_conse_dire}}</span><br/>
		   <a href="tel:{{company.tel_fono}}"><abbr title="Phone">Telefono: </abbr> {{company.tel_fono}}<br/></a>
		   <abbr title="site">Sitio Web / Email: </abbr> <span class='contact_data_item'><a href="{{company.site}}" target="_blank">{{company.site}}</a></span><br/>
		   <abbr title="Fax">Fax: </abbr> <span class='contact_data_item'>{{company.fax1}}</span><br/>
		  </address>
		  <img id='street_view_image' src="#" class='col-md-4'/>
		  </div>
          </div> <!-- company_maps_view -->
          
          </div>
          <div id='company_online_view' class='company_contents'>
			 <table data-ng-if="company.site !== ''" class="table col-sm-1 table-striped" style='width:50%; margin-top:10px;'>
              <tbody>
              <tr class='opportunity_open'>
                  <td><a href="{{company.site}}"><img id='#web_thumbnail' src="thumbnails/A28196848.png" class='company_thumbnail' alt="thumbnail" /></a></td>
                  <td><a href="{{company.site}}">{{company.site}}</a></td>
                  
                  <td data-ng-if="company.site === ''"><a href="{{company.site}}"><button type="button" class="btn btn-info">No website</button></a></td>
                   <td data-ng-if="company.site !== '' && company.webcode === '200'">
                   <button type="button" class="btn btn-success">Website available</button>
                   </td>
                   <td data-ng-if="company.site !== '' && company.webcode !== '200'"><button type="button" class="btn btn-danger">Website not working</button></td>
                  
                 
              	</tr>
              	</tbody>
              	</table>
		 <table class="table col-sm-1 table-striped" style='width:65%'>
              <thead>
                <tr class='table_company_features_header'>
                  <th>Social Media Feature</th>
                  <th></th>
                  <th>Business Feature</th>
                  <th></th>
                </tr>
              </thead>
              <tbody>
                  <tr class='table_description_item'>
                  <td class='table_description_label'>Alexa Index</td>
                  <td class='table_description_value'>{{company.alexa | number}}</td>
                  <td class='table_description_label'>Number of locations</td>
                  <td class='table_description_value'>{{company.locations | number}}</td>
              	</tr>
              <tr class='table_description_item'>
                  <td>Klout Index</td>
                  <td class='table_description_value'>{{company.klout}}</td>

                  <td class='table_description_label'>Trademarks</td>
                  <td class='table_description_value'>{{company.trademarks | number}}</td>

              	</tr>
                <tr class='table_description_item'>
                  <td class='table_description_label'>Has Twitter</td>
                  <td class='table_description_value'>{{company.twitter}}</td>

                  <td>Import/Export</td>
                  <td class='table_description_value'>{{company._export == 1 ? "Yes":"No"}}</td>

              	</tr>
                <tr class='table_description_item'>
                  <td class='table_description_label'>Has Facebook</td>
                  <td class='table_description_value'>{{company.facebook}}</td>

                  <td class='table_description_label'>National Patents</td>
                  <td class='table_description_value'>{{company.national_patents | number}}</td>

              	</tr>
                <tr class='table_description_item'>
                  <td class='table_description_label'>Has e-Commerce</td>
                  <td class='table_description_value'>{{company.js}}</td>

                  <td class='table_description_label'>International Patents</td>
                  <td class='table_description_value'>{{company.international_patents | number}}</td>

              	</tr>
				<tr class='table_description_item'>
                  <td class='table_description_label'>Adapted to mobile</td>
                  <td class='table_description_value'>{{company.jq}}</td>

                  <td class='table_description_label'>Employees</td>
                  <td class='table_description_value'>{{company.empleados}}</td>

              	</tr>
              	<tr class='table_description_item'>
                  <td class='table_description_label'>Uses analytics</td>
                  <td class='table_description_value'>{{company.ga}}</td>

                  <td class='table_description_label'>Detrimental public information</td>
                  <td  class='table_description_value'>{{JUDICIAL == 0 ? "No" : "Yes"}}</td>

              	</tr>
              </tbody>
              </table>

          </div>
          
	<div id='company_timeline_view' class='company_contents'>

			<div class='row'>			
				<iframe id='target_timeline_iframe' style='border:0px;width:100%;height:520px' class='col-sm-12' src='#' scrolling="yes" ></iframe>
			</div>


    </div>
    	<!-- END TIMELINE -->

<div>
          </div>
        </div>
      </div>
    <!-- COMPANY VIEW ENDS -->
	<!-- PIPELINE VIEW BEGIN -->
    	<div style='display:none' class="container wooda_view"  data-ng-controller="pipelineController" id='pipeline_view'>
	    
	    <div class="panel panel-default panel-table">
              <div class="panel-heading suggestions_header_bar">
                <div class="row ">
                  <div class="col col-xs-6">
                    <h3 class="panel-title ">Pipeline <button id='filter_suggested_pipe' style='float:right;' class="btn btn-default">Filtro/Orden</button></h3>
                  </div>
           
                </div>
              </div>
              <div class="panel-body">
                <table class="table_suggestions table table-striped table-bordered table-list">
                  <thead>
                    <tr class='suggestions_header_bar suggestions_header_subbar'>
                        <th class='suggestions_header_title'>Empresa<span class=""></span></th>
                        <th class='suggestions_ipe suggestions_header_title' >Riesgo <span class=""></span>
                        </th>
                        <th class='suggestions_header_title'>Direccion<span class=""></span></th>
                        <th class='suggestions_header_title'>Municipio<span class=""></span></th>
                        <th class='suggestions_header_title' style='width:70px;'>Contactada<span class=""></span></th>
                        <th class='suggestions_header_title' style='width:70px;'>Interes<span class=""></span></th>
                        <th class='suggestions_header_title' style='width:70px;'>Motivo<span class=""></span></th>

                    </tr> 
                  </thead>
                  <tbody>
                          <tr data-ng-repeat="x in pipeline" data-ng-click='show_company($event);' data-cif='{{x.CIF}}' style='cursor:hand'>
                            <td>{{x.nombre_empresa}}</td>
                            <td class='suggestion_item'><span>{{x.IPE}}</span></td>
                            <td class='suggestion_item'><span>{{x.calle}} {{x.n_mero}} {{x.resto}}</span></td>
                            <td class='suggestion_item'><span>{{x.municipio}}</span></td>
                            <td class='suggestion_item'><span>{{x.visit}}</span></td>
                            <td class='suggestion_item'><span>{{x.interest}}</span></td>
                            <td class='suggestion_item'><span>{{x.status_motive}}</span></td>

                          </tr>
                        </tbody>
                </table>
            
              </div>
              <div class="panel-footer">
                <div class="row">
                  <!--
                  <div class="col col-xs-4">Page 1 of 3
                  </div>
                  <div class="col col-xs-8">
                    <ul class="pagination hidden-xs pull-right">
                      <li><a href="#">1</a></li>
                      <li><a href="#">2</a></li>
                      <li><a href="#">3</a></li>
                    </ul>
                    <ul class="pagination visible-xs pull-right">
                        <li><a href="#">«</a></li>
                        <li><a href="#">»</a></li>
                    </ul>
                  </div>
                  -->
                </div>
              </div>
            </div>
            </div>
            
	   
   
    <!-- DASHBOARD VIEW END -->     
     <div class="container wooda_view"  data-ng-controller="dashboardController" id='dashboard_view'>
          <div class='row dashboard_header'>
          	<div class="col-md-4 pull-right" style="float: right">
       			<button onclick='showDashboard("total")' type="button" id='button_dashboard_total' class="button_dashboard btn btn-primary btn-xs">Selecci&oacute;n de empresas</button>
       		 <!-- 
       			<button onclick='showDashboard("pipeline")' type="button" id='button_dashboard_pipeline' class="button_dashboard btn btn-primary btn-xs">Pipeline Analysis</button>                
       			<button onclick='showDashboard("suggestions")' type="button" id='button_dashboard_suggestions' class="button_dashboard btn btn-primary btn-xs">Suggestions</button>
          	  -->
          	</div>
          </div>
	<div class='dashboard_container'>
     <div id="dashboard_pipeline" class='spotfire_dashboard_card'></div>
     
 	 <div id="dashboard_suggestions" class='spotfire_dashboard_card'></div>
     <div id="dashboard_total" class='spotfire_dashboard_card'></div>
     
 	</div> 
	 <!-- DASHBOARD VIEW END -->
     
    </div>
    <footer class="section section-primary">
      <div class="container">
        <div class="row">
          <div class="col-md-6 wooda_footer_text">Copyright (R)</div>
          <div class="col-md-6 text-right wooda_footer_text">Powered by Equifax Iberia</div>
        </div>
      </div>
    </footer>


  </div>
<script>

function resizeIframe(obj){
    obj.style.height = 0;
    obj.style.height = obj.contentWindow.document.body.scrollHeight + 'px';
 }
 
var app = angular.module('myApp', []);

display_company = function (cif,handler){
	
	if (cif === undefined)
	{
		if (handler !== undefined)
		{
			handler({});			
		}
	}
	else
	{
    if (cif !== '') $('#company_spinner').css('display','block');
	  lookup_company(cif, function (data)
			{
				var item_data = JSON.parse(data);
				WOODA.cif = cif;
				WOODA.company = item_data;
				if (item_data.in_pipe === 'SI')
				{
		    		$('#company_add_pipe').css('display','none');$('#company_remove_pipe').css('display','block');					
				}
				else
				{
		    		$('#company_add_pipe').css('display','block');$('#company_remove_pipe').css('display','none');										
				}
        refresh_status_company(item_data);
        $('textarea#company_notes').val(WOODA.company.notes);
				$('#company_add_pipe').unbind('click').bind('click',function(){add_to_pipe();});
			  	$('#company_remove_pipe').unbind('click').bind('click',function(){remove_from_pipe();});

			  	var uri = 'charts.php?cif=' + cif;
				$('#target_charts_iframe').attr('src',uri);
				var uri_timeline = 'timeline2.php?cif=' + cif;
				$('#target_timeline_iframe').attr('src',uri_timeline);
		
		
				// Fix url if it does not have protocol ...
		
				if (item_data !== undefined && item_data.site != undefined && item_data.site != '' && !item_data.site.includes("http"))
				{
					item_data.site = 'http://' + item_data.site; 
				}
				
			    get_near_businesses(item_data.x, item_data.y, function (data2)
			   {
				//console.log(item_data.x + "_____________" + item_data.y);
		    	var scope = angular.element($("#company_view")).scope();
		    	scope.$apply(function(){
		    		
		    		$('#company_spinner').css('display','none');

		    		scope.company = item_data;
		    		WOODA.company= scope.company;
		    	
		    	  item_data.Propension_c = item_data.Propension[0]; 
		    		var propension_label = item_data.Propension_c === '1' ? 'Muy Alta' : item_data.Propension_c === '2'  ? 'Alta' : (item_data.Propension_c === '3'  ? 'Baja' : 'Muy Baja');
		    		var risk_style = (item_data.Propension_c === '1' || item_data.Propension_c === '2') ? 'success' : item_data.Propension_c === '3' ? 'active_box_company' : 'warning';
		    		
		    		scope.company.propensity_score = propension_label;
		    		$('#company_propension_box').removeClass('success').removeClass('warning').removeClass("active").removeClass('danger');
		    		$('#company_propension_box').removeClass('success').removeClass('warning').removeClass("active").removeClass('danger').addClass(risk_style);

            // ---- RISK BOX
            item_data.risk_score_c = item_data.IPE[0]; // First character
		    		var risk_label = item_data.risk_score_c === '1' ? 'Bajo' : item_data.risk_score_c === '2'  ? 'Medio' :  'Alta';
		    		risk_style = (item_data.risk_score_c === '1' ) ? 'success' : item_data.risk_score_c === '2' ? 'active_box_company' : 'warning';

		    		scope.company.risk_score = risk_label;
		    		$('#company_risk_box').removeClass('success').removeClass('warning').removeClass("active").removeClass('danger');
		    		$('#company_risk_box').removeClass('success').removeClass('warning').removeClass("active").removeClass('danger').addClass(risk_style);

			    	// Charts
		    		scope.company.nearby = JSON.parse(data2);

	        		$('#company_current_opportunities').parent().addClass('active');
	        		$('#company_closed_opportunities').parent().removeClass('active');
	    			$('.opportunity_open').fadeIn( "slow", function() {});
	    			$('.opportunity_closed').css('display','none').parent().removeClass('active');
	    			switch_company_view('company_tasks_view');
		    		$('#company_closed_opportunities').on('click',function(event)
		    		{
		        		$('#company_current_opportunities').parent().removeClass('active');
		        		$('#company_closed_opportunities').parent().addClass('active');

		    			$('.opportunity_closed').fadeIn( "slow", function() {}).parent().addClass('active');        		
		    			$('.opportunity_open').css('display','none').parent().removeClass('active');
		    		});
		    		$('#company_current_opportunities').on('click',function(event)
		    	    {
		        		$('#company_current_opportunities').parent().addClass('active');
		        		$('#company_closed_opportunities').parent().removeClass('active');

		    			$('.opportunity_open').fadeIn( "slow", function() {});
		    			$('.opportunity_closed').css('display','none').parent().removeClass('active');
		    	    });
		    		
		    		if (handler !== null && handler !== undefined)
		    		{
		    			// wait ...
		    			handler();	
		    		}

						    	

			}); // Get business
			   

		    	});
		    	

			}
			);
     }//lookup company
		
};

app.controller('dashboardController', function($scope) 
		{
			// Fill all data with a sample call
		});

app.controller('loginController', function($scope) 
{
	});


app.controller('companyController', function($scope) 
{
	// Fill all data with a sample call	
	display_company('A08229338');	
});

app.controller('pipelineController', function($scope) 
{
	refresh_pipeline();	
    $scope.show_company = function($event)
    {
    	var cif = $($event.target).data('cif');
    	if (cif === undefined)
    	{
    		cif = $(event.target).parent().data('cif');	
    		if (cif === undefined)
        	{
        		cif = $(event.target).parent().parent().data('cif');	
        	}
    	}
    
    	if (cif !== '' && cif !== undefined)
    	{
    		$('.wooda_view').css('display','none');  
    		display_company(cif,function (){ show_view('company'); });
    		
    		$('#update_company_notes').unbind('click').bind('click',function (e)
    		{
    			var notes = $('#company_notes').val();
    			update_notes(cif,notes, function()
    			{
    				showModal('Informacion','Notas actualizadas para la empresa','OK');
    			});
    			
    		});
    	}
    	
    };
});

app.controller('suggestedController', function($scope) 
{
	// Load suggestions
	refresh_suggestions();
	
	 $scope.show_company = function($event)
	    {
	    	var cif = $($event.target).data('cif');
	    	if (cif === undefined)
	    	{
	    		cif = $(event.target).parent().data('cif');	
	    		if (cif === undefined)
	        	{
	        		cif = $(event.target).parent().parent().data('cif');	
	        	}
	    	}
	    
	    	if (cif !== '')
	    	{
	    		$('.wooda_view').css('display','none');  
	    		display_company(cif,function (){ show_view('company'); });
	    		$('#update_company_notes').unbind('click').bind('click',function (e)
	    		{
	    			var notes = $('textarea#company_notes').val();
	    			update_notes(cif,notes, function()
	    			{
	    				showModal('Informacion','Notas actualizadas para la empresa','OK');
	    			});
	    			
	    		});
	    		

	    	}
	    };
});

app.controller('calendarController', function($scope) 
{
    get_pipeline(function (data) 
  	{
	var item_list = JSON.parse(data);
	var scope = angular.element($("#calendar_view")).scope();
	scope.$apply(function(){
		var calendar_morning = Array();
		var calendar_afternoon = Array();
		for(var i = 0; i < 5; i++)
		{
			calendar_morning[i] = new Array();
			calendar_afternoon[i] = new Array();
			for(var j = 0 ; j < (1 + i%2); j++)
			{
				calendar_morning[i].push(item_list[i*5+j]);				
				calendar_afternoon[i].push(item_list[15 + i*5+j]);				
			}
		}
		scope.calendar_morning = calendar_morning;
		scope.calendar_afternoon = calendar_afternoon;
		});
  	});
    $scope.show_company = function($event)
    {
    	var cif = $($event.target).data('cif');
    	if (cif === undefined)
    	{
    		cif = $(event.target).parent().data('cif');	
    		if (cif === undefined)
        	{
        		cif = $(event.target).parent().parent().data('cif');	
        	}
    	}
    	if (cif !== '')
    	{
    		$('.wooda_view').css('display','none');  // WAIT
    		display_company(cif,function (){ show_view('company'); });
    	}
    };
});

// ---------------------------------------------
//			Spaghetti code
// --------------------------------------------- 

function show_view(view_name)
{
	//console.log('view:' + view_name);
	$('.wooda_view').css('display','none');  
	//alert('view: ' + '#' + view_name + '_view');
	$( '#' + view_name + '_view' ).fadeIn( "slow", function() {
	});
	$('.top_buttons').parent().removeClass('active');	
	$('#' + view_name + '_top_button').parent().addClass('active');
	if (view_name === 'login')
	{
		$('.logged_in').css('display','none');
		WOODA.user = {};
	}
	else if (view_name === 'dashboard')
	{
			showDashboard('total');
	}
	else if (WOODA.user.name === undefined)
	{
		var u = $('#userName').val();
		var p = $('#userPassword').val();
		auth_user(u,p, function(result){
			if (result !== '')
			{
				result = JSON.parse(result);
				if (result.result === 'ok')
				{
					WOODA.user = result;
					$('#user_name').text(WOODA.user.name);
					refresh_pipeline();
					refresh_suggestions();
				}
				else
				{
					showModal('Error','Usuario o Clave no validas','Cerrar');
					show_view('login');
				}
			}
		});
		

	}
	
	refresh_status_company();
  // Fix it
  if (view_name !== 'company')
  {
    $('#company_spinner').css('display','none');
  }

};

$('#suggested_top_badge').on('click',function (e)
{
	show_view('suggested');
});
$('.top_buttons').on('click',function(e)
{
	var view_name = e.target.id.split('_')[0];
	show_view(view_name);
});


download_file = function (file)
{	
	top.location.href = file;
}

switch_company_view = function (view)
{
	$('.company_contents').css('display','none');
	$( '#' + view ).fadeIn( "slow", function() {
		
		
		switch (view)
		{
		case 'company_maps_view':
		//	if (WOODA.map === undefined)
		//	{
			var map = new google.maps.Map(document.getElementById('map'), {
			zoom: 15,
			center: new google.maps.LatLng(WOODA.company.y, WOODA.company.x ),
			mapTypeId: google.maps.MapTypeId.ROADMAP
			});

			var infowindow = new google.maps.InfoWindow();

			var marker, i;
			var json = WOODA.company.nearby;

			$.each(json, function(key) {
				var pinColor;
				if(json[key].cif != WOODA.company.CIF){

					switch(json[key].in_pipe)
					{
					case 'SI': pinColor = "a3d7a3"; break;
					default:
						pinColor = "afafaf"; break;
					}
				
		var pinImage = new google.maps.MarkerImage("http://chart.apis.google.com/chart?chst=d_map_pin_letter&chld=%E2%80%A2|" + pinColor,
        new google.maps.Size(21, 34),
        new google.maps.Point(0,0),
        new google.maps.Point(10, 34));

    	var pinShadow = new google.maps.MarkerImage("http://chart.apis.google.com/chart?chst=d_map_pin_shadow",
        new google.maps.Size(40, 37),
        new google.maps.Point(0, 0),
        new google.maps.Point(12, 35));
      
			
			marker = new google.maps.Marker({
			position: new google.maps.LatLng(json[key].y, json[key].x),
			map: map,
			icon: pinImage,
      shadow: pinShadow
			});

			google.maps.event.addListener(marker, 'click', (function(marker, i) {
			return function() {
			infowindow.setContent("<address style='cursor: hand' onclick='display_company(\""+json[key].cif+"\")'>" + 
				 "<strong>"+json[key].nombre_empresa+"</strong> <i class='fa fa-pencil-square-o'></i><br />CIF: "+json[key].cif+"<br />"+ 
				 "<small><strong>Telefono: </strong>"+ json[key].tel_fono  +"</small><br />"+  
				 "</address>");

			infowindow.open(map, marker);
			}
			})(marker, i));
			}
			});
					var pinColor;

					pinColor = "981e32";

				var pinImage = new google.maps.MarkerImage("http://chart.apis.google.com/chart?chst=d_map_pin_letter&chld=%E2%80%A2|" + pinColor,
        new google.maps.Size(21, 34),
        new google.maps.Point(0,0),
        new google.maps.Point(10, 34));
    var pinShadow = new google.maps.MarkerImage("http://chart.apis.google.com/chart?chst=d_map_pin_shadow",
        new google.maps.Size(40, 37),
        new google.maps.Point(0, 0),
        new google.maps.Point(12, 35));
      
			
			marker = new google.maps.Marker({
			position: new google.maps.LatLng(WOODA.company.y, WOODA.company.x),
			map: map,
			icon: pinImage,
      shadow: pinShadow
			});

			google.maps.event.addListener(marker, 'click', (function(marker, i) {
			return function() {
			infowindow.setContent("<address>" + 
				 "<strong>"+WOODA.company.nombre_empresa+"</strong> <i class='fa fa-pencil-square-o'></i><br />CIF: "+WOODA.company.CIF+"<br />"+ 
				 "<small><strong>Telefono: </strong>"+ WOODA.company.tel_fono  +"</small><br />"+  
				 "</address>");

			infowindow.open(map, marker);
			}
			})(marker, i));
			$('#street_view_image').attr('src','#');
			var url = "https://maps.googleapis.com/maps/api/streetview?size=320x200&location="+WOODA.company.y+","+WOODA.company.x+"&heading=151.78&pitch=-0.76&key=AIzaSyDIfxQLlpCyC9GlG0Hyf0ZRszhu1um0F5Y";
			$('#street_view_image').attr('src',url);
			  
			map.center = new google.maps.LatLng(WOODA.company.y, WOODA.company.x );
			
			break;
		case 'company_charts_view':
			// Set the URL
			
			var uri = 'charts.php?cif=' + WOODA.company.CIF;
			if ( $('#target_charts_iframe').attr('src') != uri)
			{
				// Reload
				$('#target_charts_iframe').attr('src',uri);				
			}
			
						       break;
		case 'company_timeline_view':
			// Set the URL
			
			var uri = 'timeline2.php?cif=' + WOODA.company.CIF;
			//var uri_timeline = 'timeline2.php?cif=' + 'A02318285';//cif;
			if ( $('#target_timeline_iframe').attr('src') != uri)
			{
				// Reload
				$('#target_timeline_iframe').attr('src',uri);				
			}
			
			break;			       
						       
		}
	});

};

var customization = spotfire.webPlayer.Customization();  //Optional configuration settings
	  

$( document ).ready(function() {
			show_view('login');
			if (location.hostname === 'www.efxlab.com' && document.URL.indexOf('prepro') === -1)
			{
        // Production environment - Clear username & pass			  
  		  $('#userName').val('');
	  	  $('#userPassword').val('');
			}

			/*
			// Init Spotfire
			var c_serverUrl = "https://spotfire.cloud.tibco.com/spotfire/wp/";
      		var c_analysisPath_1 = "/users/hawaii/Public/MuestraPipeline_CS1";
      		var c_analysisPath_2 = "/users/hawaii/Public/MuestraSugeridos_CS1";
      		var c_analysisPath_3 = "/users/hawaii/Public/MuestraTotal_CS1";
      
      		var c_parameters = "";  //Optional configuration block
      		var customization = new spotfire.webPlayer.Customization();  //Optional configuration settings
      
      		var app;
      
      		var c_reloadAnalysisInstance = false;
      
      		app = new spotfire.webPlayer.Application(c_serverUrl, customization, c_analysisPath_1, c_parameters, c_reloadAnalysisInstance);
      		app2 = new spotfire.webPlayer.Application(c_serverUrl, customization, c_analysisPath_2, c_parameters, c_reloadAnalysisInstance);
			app3 = new spotfire.webPlayer.Application(c_serverUrl, customization, c_analysisPath_3, c_parameters, c_reloadAnalysisInstance);
         
      		//Hide UI elements
      		customization.showDodPanel = false;
      		customization.showStatusBar = false;
      		customization.showToolBar = false;
      		customization.showPageNavigation = true;
      		customization.showClose = false;
      		customization.showAnalysisInfo = true;
      		customization.showExportFile = true;
      		customization.showExportVisualization = true;
      		customization.showUndoRedo = true;
      		customization.showFilterPanel = true;
      
      		var viewOne = app.openDocument("dashboard_pipeline", "IndividualExp", customization);
      		var viewTwo = app2.openDocument("dashboard_suggestions", "IndividualExp", customization);
      		var viewThree = app3.openDocument("dashboard_total", "IndividualExp", customization);
			//google.charts.load("current", {packages:["corechart"]});
			*/
			// Attach modal
			$("#search_box").click(function(){
				showModal('Alert Box','Sorry this feature is not ready yet!','Close');
    		});

			$(".add_opportunity").click(function(){
				 $("#newOpportunity").modal();
    		});

			
			// Attach modal
			$("#wooda_icon").click(function(){
		        $("#modalWooda").modal();
    		});
			$("#help_icon").click(function(){
		        $("#modalHelp").modal();
    		});
			
			// Enable tooltips
			$('[data-toggle="tooltip"]').tooltip();
			// Enable popovers
			$('[data-toggle="popover"]').popover();
			
});

function showDashboard(tab_name)
{
	$('.button_dashboard').removeClass('button_dashboard_active');
	switch(tab_name)
	{
		case 'total':$('#button_dashboard_total').addClass('button_dashboard_active');break;
		case 'pipeline':$('#button_dashboard_pipeline').addClass('button_dashboard_active');break;
		case 'total':$('#button_dashboard_suggestions').addClass('button_dashboard_active');break;
	}
	$('.spotfire_dashboard_card').css('display','none');
	$('#dashboard_' + tab_name).css('display','block');
}

</script>

<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.6.4/js/bootstrap-datepicker.min.js"> </script>
</body></html>